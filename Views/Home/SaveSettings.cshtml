@model TicketMaster.Models.ApplicationSetting
@{
    ViewData["Title"] = "Application Settings";

    string fontName = Model?.FontFamily ?? "Not Set";
    string displayFont = fontName.Length > 8
        ? fontName.Substring(0, 8) + "..."
        : fontName;
}

<!-- Import the CSS file -->
<link rel="stylesheet" href="~/css/invitation-styles.css" />

<div class="invitation-container">
    <div class="header-section">
        <h2 class="page-title">Application Settings</h2>
        <p class="page-subtitle">Configure your application's appearance and behavior</p>
    </div>

    <div class="invitation-form">
        <!-- Current Settings Overview -->
        <div class="form-section">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-palette"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number" style="color: @(Model?.ColorCode ?? "#007bff");">@(Model?.ColorCode ?? "Not Set")</h3>
                        <p class="stat-label">Current Color</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-text-height"></i>
                    </div>
                    <div class="stat-content">
                        <h3 class="stat-number">@(Model?.FrontSize ?? "Not Set")</h3>
                        <p class="stat-label">Font Size</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-font"></i>
                    </div>
                    <div class="stat-content">
                        <div class="stat-content">
                            <h3 class="stat-number" style="font-family: @(Model?.FontFamily ?? "inherit");">
                                @displayFont
                            </h3>
                            <p class="stat-label">Font Family</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Form -->
        <div class="form-section">
            <h4 class="section-title">
                <i class="fas fa-cog"></i>
                Configuration Settings
            </h4>

            <form asp-action="SaveSettings" asp-controller="Home" method="post" id="settingsForm">
                @if (Model?.Id > 0)
                {
                    <input type="hidden" asp-for="Id" />
                }

                <div class="form-row">
                    <!-- Color Code Setting -->
                    <div class="form-group">
                        <label asp-for="ColorCode" class="form-label">
                            <i class="fas fa-palette"></i>
                            Primary Color Code
                        </label>
                        <div class="color-input-group">
                            <input asp-for="ColorCode" type="color" class="form-control color-picker" id="colorPicker" />
                            <input asp-for="ColorCode" type="text" class="form-control color-text" id="colorText" placeholder="#007bff" maxlength="7" />
                            <button type="button" class="btn-small btn-secondary" onclick="resetColor()" title="Reset to default">
                                <i class="fas fa-undo"></i>
                            </button>
                        </div>
                        <small class="form-text">Choose your application's primary color theme</small>
                        <span asp-validation-for="ColorCode" class="text-danger"></span>
                    </div>

                    <!-- Font Size Setting -->
                    <div class="form-group">
                        <label asp-for="FrontSize" class="form-label">
                            <i class="fas fa-text-height"></i>
                            Font Size
                        </label>
                        <div class="font-size-group">
                            <select asp-for="FrontSize" class="form-control" id="fontSizeSelect">
                                <option value="">Select Font Size</option>
                                <option value="10px">10px - Extra Small</option>
                                <option value="12px">12px - Small</option>
                                <option value="14px">14px - Default</option>
                                <option value="16px">16px - Medium</option>
                                <option value="18px">18px - Large</option>
                                <option value="20px">20px - Extra Large</option>
                                <option value="22px">22px - Section Heading</option>
                                <option value="24px">24px - Heading</option>
                                <option value="28px">28px - Large Heading</option>
                                <option value="32px">32px - Title</option>
                                <option value="36px">36px - Big Title</option>
                                <option value="48px">48px - Banner</option>
                            </select>
                            <div class="font-preview" id="fontPreview">
                                Sample Text Preview
                            </div>
                        </div>
                        <small class="form-text">Set the base font size for your application</small>
                        <span asp-validation-for="FrontSize" class="text-danger"></span>
                    </div>
                </div>

                <div class="form-row">
                    <!-- Font Family Setting -->
                    <div class="form-group full-width">
                        <label asp-for="FontFamily" class="form-label">
                            <i class="fas fa-font"></i>
                            Font Family
                        </label>
                        <div class="font-family-group">
                            <select asp-for="FontFamily" class="form-control" id="fontFamilySelect">
                                <option value="">Select Font Family</option>
                                <option value="Arial, sans-serif">Arial</option>
                                <option value="'Helvetica Neue', Helvetica, sans-serif">Helvetica</option>
                                <option value="'Times New Roman', Times, serif">Times New Roman</option>
                                <option value="Georgia, serif">Georgia</option>
                                <option value="'Courier New', Courier, monospace">Courier New</option>
                                <option value="Verdana, sans-serif">Verdana</option>
                                <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                                <option value="'Lucida Sans', sans-serif">Lucida Sans</option>
                                <option value="Impact, sans-serif">Impact</option>
                                <option value="'Comic Sans MS', cursive">Comic Sans MS</option>
                            </select>
                            <div class="font-family-preview" id="fontFamilyPreview">
                                The quick brown fox jumps over the lazy dog. 1234567890
                            </div>
                        </div>
                        <small class="form-text">Choose the primary font family for your application</small>
                        <span asp-validation-for="FontFamily" class="text-danger"></span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary" id="saveBtn">
                        <i class="fas fa-save"></i>
                        Save Settings
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()">
                        <i class="fas fa-undo"></i>
                        Reset to Defaults
                    </button>
                    <button type="button" class="btn btn-info" onclick="exportSettings()">
                        <i class="fas fa-download"></i>
                        Export Settings
                    </button>
                    <a href="@Url.Action("Index", "Home")" class="btn btn-outline">
                        <i class="fas fa-arrow-left"></i>
                        Back to Dashboard
                    </a>
                </div>
            </form>
        </div>

        <!-- Settings History/Backup Section -->
        <div class="form-section">
            <h4 class="section-title">
                <i class="fas fa-history"></i>
                Quick Actions
            </h4>
            <div class="quick-actions">
                <button type="button" class="btn btn-outline" onclick="importSettings()">
                    <i class="fas fa-upload"></i>
                    Import Settings
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Hidden file input for import -->
<input type="file" id="importFileInput" accept=".json" style="display: none;" />

@section Scripts {
    <script>
        // Default values
        const defaultSettings = {
            colorCode: '#007bff',
            fontSize: '14px',
            fontFamily: 'Arial, sans-serif'
        };

        // Preset themes
        const presets = {
            modern: {
                colorCode: '#6f42c1',
                fontSize: '16px',
                fontFamily: "'Helvetica Neue', Helvetica, sans-serif"
            },
            classic: {
                colorCode: '#198754',
                fontSize: '14px',
                fontFamily: "'Times New Roman', Times, serif"
            },
            dark: {
                colorCode: '#495057',
                fontSize: '15px',
                fontFamily: "'Trebuchet MS', sans-serif"
            }
        };

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateLivePreview();
            showToast('Settings loaded successfully', 'success');
        });

        function setupEventListeners() {
            // Color picker synchronization
            const colorPicker = document.getElementById('colorPicker');
            const colorText = document.getElementById('colorText');

            colorPicker.addEventListener('input', function() {
                colorText.value = this.value;
                updateLivePreview();
            });

            colorText.addEventListener('input', function() {
                if (isValidColor(this.value)) {
                    colorPicker.value = this.value;
                    updateLivePreview();
                }
            });

            // Font size preview
            document.getElementById('fontSizeSelect').addEventListener('change', function() {
                updateFontPreview();
                updateLivePreview();
            });

            // Font family preview
            document.getElementById('fontFamilySelect').addEventListener('change', function() {
                updateFontFamilyPreview();
                updateLivePreview();
            });

            // Form validation
            document.getElementById('settingsForm').addEventListener('submit', function(e) {
                if (!validateForm()) {
                    e.preventDefault();
                    return false;
                }

                showToast('Saving settings...', 'info');
                // The form will submit normally after this
            });
        }

        function updateLivePreview() {
            const colorCode = document.getElementById('colorText').value || defaultSettings.colorCode;
            const fontSize = document.getElementById('fontSizeSelect').value || defaultSettings.fontSize;
            const fontFamily = document.getElementById('fontFamilySelect').value || defaultSettings.fontFamily;

            const preview = document.getElementById('livePreview');
            const previewCard = preview.querySelector('.preview-card');
            const previewBtn = preview.querySelector('.preview-btn');

            previewCard.style.cssText = `
                font-family: ${fontFamily};
                font-size: ${fontSize};
                border-left: 4px solid ${colorCode};
            `;

            previewBtn.style.cssText = `
                background-color: ${colorCode};
                border-color: ${colorCode};
                font-family: ${fontFamily};
                font-size: ${fontSize};
            `;

            // Update stats cards
            updateStatsDisplay();
        }

        function updateFontPreview() {
            const fontSize = document.getElementById('fontSizeSelect').value;
            const preview = document.getElementById('fontPreview');

            if (fontSize) {
                preview.style.fontSize = fontSize;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function updateFontFamilyPreview() {
            const fontFamily = document.getElementById('fontFamilySelect').value;
            const preview = document.getElementById('fontFamilyPreview');

            if (fontFamily) {
                preview.style.fontFamily = fontFamily;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        }

        function updateStatsDisplay() {
            const colorCode = document.getElementById('colorText').value || 'Not Set';
            const fontSize = document.getElementById('fontSizeSelect').value || 'Not Set';
            const fontFamily = document.getElementById('fontFamilySelect').value || 'Not Set';

            const statNumbers = document.querySelectorAll('.stat-number');
            if (statNumbers[0]) {
                statNumbers[0].textContent = colorCode;
                statNumbers[0].style.color = colorCode;
            }
            if (statNumbers[1]) {
                statNumbers[1].textContent = fontSize;
            }
            if (statNumbers[2]) {
                statNumbers[2].textContent = fontFamily.split(',')[0].replace(/'/g, '');
                statNumbers[2].style.fontFamily = fontFamily;
            }
        }

        function resetColor() {
            document.getElementById('colorPicker').value = defaultSettings.colorCode;
            document.getElementById('colorText').value = defaultSettings.colorCode;
            updateLivePreview();
            showToast('Color reset to default', 'info');
        }

        function resetForm() {
            document.getElementById('colorPicker').value = defaultSettings.colorCode;
            document.getElementById('colorText').value = defaultSettings.colorCode;
            document.getElementById('fontSizeSelect').value = defaultSettings.fontSize;
            document.getElementById('fontFamilySelect').value = defaultSettings.fontFamily;

            updateFontPreview();
            updateFontFamilyPreview();
            updateLivePreview();

            showToast('Form reset to default values', 'info');
        }

        function loadPreset(presetName) {
            const preset = presets[presetName];
            if (!preset) {
                showToast('Preset not found', 'error');
                return;
            }

            document.getElementById('colorPicker').value = preset.colorCode;
            document.getElementById('colorText').value = preset.colorCode;
            document.getElementById('fontSizeSelect').value = preset.fontSize;
            document.getElementById('fontFamilySelect').value = preset.fontFamily;

            updateFontPreview();
            updateFontFamilyPreview();
            updateLivePreview();

            showToast(`${presetName.charAt(0).toUpperCase() + presetName.slice(1)} theme loaded`, 'success');
        }

        function exportSettings() {
            const settings = {
                colorCode: document.getElementById('colorText').value,
                fontSize: document.getElementById('fontSizeSelect').value,
                fontFamily: document.getElementById('fontFamilySelect').value,
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(settings, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `application-settings-${new Date().getTime()}.json`;
            link.click();

            showToast('Settings exported successfully', 'success');
        }

        function importSettings() {
            document.getElementById('importFileInput').click();
        }

        // Handle file import
        document.getElementById('importFileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const settings = JSON.parse(e.target.result);

                    if (settings.colorCode) {
                        document.getElementById('colorPicker').value = settings.colorCode;
                        document.getElementById('colorText').value = settings.colorCode;
                    }
                    if (settings.fontSize) {
                        document.getElementById('fontSizeSelect').value = settings.fontSize;
                    }
                    if (settings.fontFamily) {
                        document.getElementById('fontFamilySelect').value = settings.fontFamily;
                    }

                    updateFontPreview();
                    updateFontFamilyPreview();
                    updateLivePreview();

                    showToast('Settings imported successfully', 'success');
                } catch (error) {
                    showToast('Invalid settings file', 'error');
                }
            };
            reader.readAsText(file);
        });

        function validateForm() {
            let isValid = true;
            const colorCode = document.getElementById('colorText').value;

            // Validate color code
            if (colorCode && !isValidColor(colorCode)) {
                showToast('Please enter a valid color code (e.g., #007bff)', 'error');
                isValid = false;
            }

            return isValid;
        }

        function isValidColor(color) {
            return /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(color);
        }

        // Toast notification function (reusing from your existing code)
        function showToast(message, type = 'info') {
            const existingToasts = document.querySelectorAll('.toast');
            existingToasts.forEach(toast => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            });

            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;

            const iconMap = {
                'success': 'check-circle',
                'error': 'exclamation-circle',
                'warning': 'exclamation-triangle',
                'info': 'info-circle'
            };

            toast.innerHTML = `
                <i class="fas fa-${iconMap[type] || 'info-circle'}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(toast);

            requestAnimationFrame(() => {
                toast.classList.add('show');
            });

            const hideTimeout = type === 'error' ? 5000 : 3000;
            setTimeout(() => {
                if (toast.classList.contains('show')) {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        if (toast.parentNode) {
                            document.body.removeChild(toast);
                        }
                    }, 300);
                }
            }, hideTimeout);

            toast.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            });
        }
    </script>

    <style>
        /* Toast notifications - matching your existing style */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            border-radius: 6px;
            color: white;
            font-weight: 500;
            z-index: 9999;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            cursor: pointer;
        }

            .toast.show {
                transform: translateX(0);
                opacity: 1;
            }

        .toast-success {
            background: #28a745;
        }

        .toast-error {
            background: #dc3545;
        }

        .toast-warning {
            background: #ffc107;
            color: #212529;
        }

        .toast-info {
            background: #17a2b8;
        }

        /* Settings page specific styles */
        /* Additional styles for settings page */
        .color-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-picker {
            width: 50px;
            height: 38px;
            padding: 2px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }

        .color-text {
            flex: 1;
        }

        .font-size-group, .font-family-group {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .font-preview, .font-family-preview {
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
            background: #f8f9fa;
            min-height: 40px;
            display: none;
        }

        .full-width {
            flex: 1 1 100%;
        }

        .preview-container {
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            background: #f8f9fa;
        }

        .preview-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .preview-btn {
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: flex-start;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

            .quick-actions .btn {
                flex: 1;
                min-width: 150px;
            }

        @@media (max-width: 768px) {
            .form-actions

        {
            flex-direction: column;
        }

        .form-actions .btn {
            width: 100%;
        }

        .color-input-group {
            flex-direction: column;
            align-items: stretch;
        }

        .color-picker {
            width: 100%;
        }

        }

        .font-family-display {
            white-space: nowrap; /* Prevent line break */
            overflow: hidden; /* Hide overflow text */
            text-overflow: ellipsis; /* Add "..." */
            display: block; /* Ensure block-level for ellipsis */
            max-width: 100%; /* Keep within card */
        }
    </style>
}